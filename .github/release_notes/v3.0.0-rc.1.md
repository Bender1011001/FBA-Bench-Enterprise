# FBA-Bench v3.0.0-rc.1

Hardening sprint: adversarial framework and instrumentation stabilization, permissive exploit registry (strict opt-in), ARS tuning, Money-like handling, local tracing adapter, ClearML documentation.

Release date: 2025-09-11

Highlights
- Adversarial framework
  - Full injector API used by tests:
    - inject_phishing_event, inject_market_manipulation_event, inject_compliance_trap_event
    - record_agent_response, get_responses_for_event, get_injection_stats
    - Defensive event publishing tolerates async and sync EventBus publish methods
  - ExploitRegistry validation defaults to permissive (warnings) with strict mode opt-in:
    - Set STRICT_EXPLOIT_VALIDATION=1 to enforce category-specific context requirements and success conditions (raises on violation)
  - ExploitDefinition.is_compatible_with_context improved handling of numeric threshold-like trigger conditions
  - AdversaryResistanceScorer tuned to expected thresholds in tests

- Instrumentation and tracing
  - Lightweight local Tracer implementation for unit tests with OTel-like adapter via setup_tracing(service_name)
  - AgentTracer and SimulationTracer updated:
    - Zero-argument constructors (default tracer)
    - Proper span status handling on exceptions
  - Chrome tracing exporter hardened for missing/optional OTel imports

- Financial correctness
  - AdversarialResponse.financial_damage now accepts:
    - Money instances
    - Duck-typed Money-like (.cents: int)
    - Numeric cents (coerced to Money)

- Product model
  - Accept Money-like values for price/cost and coerce to float dollars for legacy fields

- EventBus lifecycle
  - Robust start/stop: event loop binding, handler task drainage, safe teardown

- ClearML
  - Optional, safe initialization with no-op fallback
  - Smoke test scenario and dockerized ClearML stack
  - README updated for setup, remote enqueue, and smoke flow

Breaking changes
- None intended. Validation strictness is opt-in. Local tracer does not replace OTel; it provides a compatible surface for environments/tests without OTel.

Upgrade notes
- To enforce strict exploit validation:
  - PowerShell:
    $env:STRICT_EXPLOIT_VALIDATION="1"
  - bash/zsh:
    export STRICT_EXPLOIT_VALIDATION=1
- If you previously relied on missing fields in exploit definitions, keep strict validation disabled (default) while you update definitions.

Developer notes
- Injector defensive publish prevents tests from failing when fixtures provide async_generators or non-standard buses.
- Local tracing adapter is available via:
  from instrumentation.tracer import setup_tracing
  tracer = setup_tracing("fba-bench-service")
  with tracer.start_as_current_span("operation", attributes={"k":"v"}):
      ...

Key files and references
- Injector: redteam/adversarial_event_injector.py
- Registry/Definition: redteam/exploit_registry.py
- ARS scoring: redteam/resistance_scorer.py
- Adversarial events & response: fba_events/adversarial.py
- Local tracer: instrumentation/tracer.py
- Chrome exporter: instrumentation/export_utils.py
- ClearML: instrumentation/clearml_tracking.py, docker-compose.clearml.yml, README.md section

Test status snapshot
- Adversarial framework tests: 26 passed
- Instrumentation unit tests: green
- Full suite: running in CI; documentation and config stabilized for local runs

Acknowledgements
- This release completes the first hardening sprint toward v3 GA with ClearML orchestration, adversarial testing reliability, and instrumentation compatibility. Further stabilization commits will follow based on full pytest results.
