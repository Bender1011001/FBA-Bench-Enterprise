<![CDATA[<?xml version="1.0" encoding="UTF-8"?>
<common_patterns>
  <!-- Common patterns for FBA-Bench Project Manager mode: Reusable command mappings, response templates, and interaction flows -->
  <overview>
    This file defines reusable patterns for common tasks in the FBA-Bench project, including command templates, user response formats, and decision trees for intent handling. These patterns ensure consistency in how the mode processes requests and interacts with users.
  </overview>

  <command_patterns>
    <pattern name="run_tests">
      <description>Standard pattern for executing tests.</description>
      <command_template>poetry run pytest</command_template>
      <parameters>
        <parameter name="verbose" type="flag" default="false">Add -v for verbose output if requested.</parameter>
      </parameters>
      <pre_execution>Running the full test suite to verify project stability.</pre_execution>
      <post_execution_summary>Tests completed. Passed: {passed_count}/{total_count}. Failed: {failed_count}.</post_execution_summary>
      <example>
        <user_request>run the tests</user_request>
        <tool_call><![CDATA[<execute_command><command>poetry run pytest</command></execute_command>]]></tool_call>
      </example>
    </pattern>

    <pattern name="start_environment">
      <description>Pattern for starting the development environment.</description>
      <command_template>docker-compose -f docker-compose.dev.yml up --build -d</command_template>
      <parameters>
        <parameter name="compose_file" type="string" default="docker-compose.dev.yml">Use 'docker-compose.full.yml' for full stack if specified.</parameter>
      </parameters>
      <pre_execution>Starting the development environment with Docker Compose. This may take a few minutes to build images.</pre_execution>
      <post_execution_summary>Environment started successfully. Services: API, DB, Frontend. Check with 'docker ps'.</post_execution_summary>
      <example>
        <user_request>start the dev server</user_request>
        <tool_call><![CDATA[<execute_command><command>docker-compose -f docker-compose.dev.yml up --build -d</command></execute_command>]]></tool_call>
      </example>
    </pattern>

    <pattern name="stop_environment">
      <description>Pattern for stopping the environment.</description>
      <command_template>docker-compose -f docker-compose.dev.yml down</command_template>
      <parameters>
        <parameter name="remove_volumes" type="flag" default="false">Add -v to remove volumes if confirmed.</parameter>
      </parameters>
      <pre_execution>Stopping all services. Confirm to proceed (this will shut down containers).</pre_execution>
      <post_execution_summary>Environment stopped. All containers removed.</post_execution_summary>
      <example>
        <user_request>stop everything</user_request>
        <tool_call><![CDATA[<execute_command><command>docker-compose -f docker-compose.dev.yml down</command></execute_command>]]></tool_call>
      </example>
    </pattern>

    <pattern name="lint_code">
      <description>Pattern for linting and formatting code.</description>
      <command_template>poetry run pre-commit run --all-files</command_template>
      <parameters>None</parameters>
      <pre_execution>Running pre-commit hooks to lint and format all files.</pre_execution>
      <post_execution_summary>Linting complete. Issues fixed: {fixed_count}. Remaining: {issues_count}.</post_execution_summary>
      <example>
        <user_request>lint my files</user_request>
        <tool_call><![CDATA[<execute_command><command>poetry run pre-commit run --all-files</command></execute_command>]]></tool_call>
      </example>
    </pattern>

    <pattern name="run_experiment">
      <description>Pattern for running experiments, requiring clarification.</description>
      <command_template>poetry run python experiment_cli.py --config-file "{config_file}" --output-path "{output_path}"</command_template>
      <parameters>
        <parameter name="config_file" type="string" required="true" default="configs/grok_learning_experiment.yaml">Path to YAML config.</parameter>
        <parameter name="output_path" type="string" required="true" default="results/my_roo_agent_run">Directory for results.</parameter>
      </parameters>
      <clarification_template>
        <question>Which experiment config would you like to use? Provide the path or choose from suggestions.</question>
        <suggestions>
          <suggest>configs/grok_learning_experiment.yaml (default learning experiment)</suggest>
          <suggest>configs/templates/golden_run_baseline.yaml (baseline run)</suggest>
          <suggest>Custom path: configs/my_custom.yaml</suggest>
        </suggestions>
      </clarification_template>
      <pre_execution>Launching experiment with config: {config_file}. Results will save to {output_path}. This may take time.</pre_execution>
      <post_execution_summary>Experiment completed. Results saved to {output_path}. View logs for details.</post_execution_summary>
      <example>
        <user_request>run an experiment</user_request>
        <clarification><ask_followup_question><question>...</question><follow_up>...</follow_up></ask_followup_question></clarification>
        <tool_call><![CDATA[<execute_command><command>poetry run python experiment_cli.py --config-file "configs/grok_learning_experiment.yaml" --output-path "results/my_run"</command></execute_command>]]></tool_call>
      </example>
    </pattern>
  </command_patterns>

  <response_patterns>
    <pattern name="success_response">
      <description>Template for successful command completion.</description>
      <template>Action completed successfully: {brief_summary}. {proactive_suggestion}</template>
      <example>{brief_summary}: Tests passed. {proactive_suggestion}: Ready to start the environment?</example>
    </pattern>

    <pattern name="error_response">
      <description>Template for handling errors.</description>
      <template>Encountered an issue: {error_summary}. Suggested fix: {fix_step}. Need help?</template>
      <example>{error_summary}: Poetry not found. {fix_step}: Run 'poetry install' first.</example>
    </pattern>

    <pattern name="help_response">
      <description>Template for providing help.</description>
      <template>Available commands: Tests (run tests), Environment (start/stop dev server), Linting (lint files), Experiments (run experiment). Examples: "run the tests", "start environment". What next?</template>
    </pattern>
  </response_patterns>

  <interaction_flows>
    <flow name="test_then_lint">
      <description>Common flow: Run tests, then suggest linting.</description>
      <steps>
        <step>Execute run_tests pattern.</step>
        <step>If success, respond with success pattern including suggestion: "Lint now?"</step>
        <step>If user agrees, execute lint_code pattern.</step>
      </steps>
    </flow>

    <flow name="env_then_experiment">
      <description>Flow for starting env and running experiment.</description>
      <steps>
        <step>Execute start_environment pattern.</step>
        <step>If success, suggest: "Run an experiment?"</step>
        <step>If yes, use run_experiment clarification and execution.</step>
      </steps>
    </flow>
  </interaction_flows>
</common_patterns>]]>