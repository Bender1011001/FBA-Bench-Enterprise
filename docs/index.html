<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>FBA-Bench | Live Leaderboard</title>
    <meta name="description" content="Live benchmark leaderboard for AI business agents under recession conditions." />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap" rel="stylesheet" />
  </head>
  <body>
    <div class="bg-grid" aria-hidden="true"></div>

    <header class="wrap header">
      <div class="brand">
        <div class="logo">FBA</div>
        <div class="brand-text">
          <div class="title">FBA-Bench</div>
          <div class="sub">Live leaderboard for AI business agents</div>
        </div>
      </div>

      <div class="right">
        <div id="liveBadge" class="badge badge-live hidden">LIVE BENCHMARK RUNNING</div>
        <div class="meta">
          <div class="meta-k">Last updated</div>
          <div id="lastUpdated" class="meta-v">Loading...</div>
        </div>
      </div>
    </header>

    <main class="wrap">
      <section class="hero">
        <h1>GPT-5.2 vs DeepSeek R1: The Bankruptcy Test</h1>
        <p class="hook">
          We are not testing if they can write poetry. We are testing if they can survive a six-month recession.
          <span id="statusLine">Status: awaiting data.</span>
        </p>
        <div class="chips">
          <a class="chip" href="api/leaderboard.json" target="_blank" rel="noreferrer">leaderboard.json</a>
          <a class="chip" href="api/live.json" target="_blank" rel="noreferrer">live.json</a>
          <a class="chip" href="sim-theater.html">sim theater</a>
          <a class="chip" href="RUNBOOK_SIM_THEATER.md">sim runbook</a>
          <a class="chip" href="docs.html">docs</a>
          <a class="chip" href="https://github.com/Bender1011001/FBA-Bench-Enterprise" target="_blank" rel="noreferrer">github</a>
        </div>
      </section>

      <section class="cards">
        <div class="card">
          <div class="card-k">Run</div>
          <div id="runId" class="card-v">--</div>
        </div>
        <div class="card">
          <div class="card-k">Tier</div>
          <div id="tier" class="card-v">--</div>
        </div>
        <div class="card">
          <div class="card-k" id="metricK1">Avg profit</div>
          <div id="metricV1" class="card-v">--</div>
        </div>
        <div class="card">
          <div class="card-k" id="metricK2">Avg ROI</div>
          <div id="metricV2" class="card-v">--</div>
        </div>
        <div class="card">
          <div class="card-k">Tokens</div>
          <div id="totalTokens" class="card-v">--</div>
        </div>
      </section>

      <section class="panel">
        <div class="panel-h">
          <div class="panel-title">Global Leaderboard</div>
          <div id="panelNote" class="panel-note">Class of 2026 models, Tier-2 prompts.</div>
        </div>

        <div class="table-wrap">
          <table class="table">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Model</th>
                <th>Provider</th>
                <th id="colK1">Net Profit</th>
                <th id="colK2">ROI</th>
                <th id="colK3">Calls</th>
                <th id="colK4">Avg Call</th>
                <th>Tokens</th>
              </tr>
            </thead>
            <tbody id="rows">
              <tr><td colspan="8" class="muted">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <footer class="footer">
        <div>FBA-Bench Enterprise. Built for the era of agentic AI.</div>
        <div class="muted">If the leaderboard looks stale, the publisher is not running or results are not deployed.</div>
      </footer>
    </main>

    <script>
      async function fetchJson(url) {
        const res = await fetch(url, { cache: "no-store" });
        if (!res.ok) throw new Error(url + " " + res.status);
        return await res.json();
      }

      function fmtPct(x) {
        if (typeof x !== "number") return "--";
        return x.toFixed(1) + "%";
      }

      function fmtPctFraction(x) {
        if (typeof x !== "number") return "--";
        return (x * 100).toFixed(1) + "%";
      }

      function fmtNum(x) {
        if (typeof x !== "number") return "--";
        return x.toLocaleString(undefined, { maximumFractionDigits: 3 });
      }

      function fmtSec(x) {
        if (typeof x !== "number") return "--";
        return x.toFixed(2) + "s";
      }

      function fmtMoney(x) {
        if (typeof x !== "number") return "--";
        const sign = x >= 0 ? "+" : "-";
        const abs = Math.abs(x);
        return sign + "$" + abs.toLocaleString(undefined, { maximumFractionDigits: 2 });
      }

      function profitClass(x) {
        if (typeof x !== "number") return "q-neutral";
        if (x > 0.01) return "q-good";
        if (x < -0.01) return "q-bad";
        return "q-warn";
      }

      function render(lb, live) {
        const rankings = (lb && lb.rankings) ? lb.rankings : [];
        const mode = (lb && typeof lb.metric_mode === "string") ? lb.metric_mode : "agentic";

        document.getElementById("lastUpdated").textContent = (lb && lb.generated_at) ? lb.generated_at : "Unknown";
        document.getElementById("runId").textContent = (lb && lb.active_run && lb.active_run.run_id) ? lb.active_run.run_id : "--";
        document.getElementById("tier").textContent = (lb && lb.active_run && lb.active_run.tier) ? lb.active_run.tier : "--";
        document.getElementById("totalTokens").textContent = (lb && lb.summary) ? fmtNum(lb.summary.total_tokens) : "--";

        // Metric cards (prefer agentic profit metrics; fall back to prompt-scoring if needed).
        const k1 = document.getElementById("metricK1");
        const v1 = document.getElementById("metricV1");
        const k2 = document.getElementById("metricK2");
        const v2 = document.getElementById("metricV2");

        k1.textContent = "Avg profit";
        k2.textContent = "Avg ROI";
        if (lb && lb.summary && typeof lb.summary.avg_total_profit === "number") {
          v1.textContent = fmtMoney(lb.summary.avg_total_profit);
        } else if (lb && lb.summary && typeof lb.summary.avg_quality_score === "number") {
          v1.textContent = fmtNum(lb.summary.avg_quality_score);
        } else {
          v1.textContent = "--";
        }
        if (lb && lb.summary && typeof lb.summary.avg_roi_pct === "number") {
          v2.textContent = fmtPct(lb.summary.avg_roi_pct);
        } else if (lb && lb.summary && typeof lb.summary.avg_success_rate === "number") {
          v2.textContent = fmtPctFraction(lb.summary.avg_success_rate);
        } else {
          v2.textContent = "--";
        }

        const active = !!(live && live.active);
        const badge = document.getElementById("liveBadge");
        if (active) badge.classList.remove("hidden");
        else badge.classList.add("hidden");

        const statusLine = document.getElementById("statusLine");
        if (live && typeof live.status === "string") {
          statusLine.textContent = "Current Status: " + live.status + " (" + (live.completed || 0) + "/" + (live.total || 0) + ")";
        } else {
          statusLine.textContent = "Status: awaiting data.";
        }

        const rows = document.getElementById("rows");
        if (!rankings.length) {
          rows.innerHTML = '<tr><td colspan="8" class="muted">No data yet.</td></tr>';
          return;
        }

        rows.innerHTML = rankings.map(r => {
          if (mode === "prompt") {
            const q = (typeof r.quality_score === "number") ? r.quality_score : 0;
            const sr = (typeof r.success_rate === "number") ? r.success_rate : 0;
            const rt = (typeof r.avg_response_time === "number") ? r.avg_response_time : null;
            return `
              <tr>
                <td><span class="rank">${r.rank}</span></td>
                <td class="mono">${(r.model_slug || r.model_name || "unknown")}</td>
                <td>${(r.provider || "unknown")}</td>
                <td><span class="pill ${profitClass(q - 0.85)}">${fmtNum(q)}</span></td>
                <td><span class="pill ${sr >= 1.0 ? "q-good" : sr >= 0.8 ? "q-warn" : "q-bad"}">${fmtPctFraction(sr)}</span></td>
                <td class="mono">${fmtSec(rt)}</td>
                <td>${fmtSec(null)}</td>
                <td class="mono">${fmtNum(r.total_tokens)}</td>
              </tr>
            `;
          }

          const p = (typeof r.total_profit === "number") ? r.total_profit : null;
          const roi = (typeof r.roi_pct === "number") ? r.roi_pct : null;
          const calls = (typeof r.llm_calls === "number") ? r.llm_calls : null;
          const avgCall = (typeof r.avg_call_seconds === "number") ? r.avg_call_seconds : null;
          const tokens = (typeof r.total_tokens === "number") ? r.total_tokens : null;
          return `
            <tr>
              <td><span class="rank">${r.rank}</span></td>
              <td class="mono">${(r.model_slug || r.model_name || "unknown")}</td>
              <td>${(r.provider || "unknown")}</td>
              <td><span class="pill ${profitClass(p)}">${fmtMoney(p)}</span></td>
              <td><span class="pill ${profitClass(roi)}">${roi === null ? "--" : fmtPct(roi)}</span></td>
              <td class="mono">${calls === null ? "--" : fmtNum(calls)}</td>
              <td>${fmtSec(avgCall)}</td>
              <td class="mono">${fmtNum(tokens)}</td>
            </tr>
          `;
        }).join("");
      }

      async function tick() {
        try {
          const [lb, live] = await Promise.all([
            fetchJson("api/leaderboard.json"),
            fetchJson("api/live.json").catch(() => null),
          ]);
          render(lb, live);
        } catch (e) {
          const rows = document.getElementById("rows");
          rows.innerHTML = '<tr><td colspan="7" class="muted">Failed to load leaderboard.json</td></tr>';
        }
      }

      tick();
      setInterval(tick, 10000);
    </script>
  </body>
</html>
